# GarageLog セキュリティポリシー

## 1. 概要

GarageLog（以下「本サービス」）は、個人開発レベルのサービスとして、ユーザーの個人情報と決済情報を適切に保護するためのセキュリティ対策を実施しています。

## 2. カード情報の非保持化

### 2.1 方針
本サービスは、クレジットカード情報を一切保持しません。

### 2.2 実装
- **Stripe Checkout** を使用し、カード情報はブラウザから Stripe へ直接送信
- 自社サーバー（Vercel）や Firestore にはカード情報を保存しない
- ログやエラートラッキングにもカード番号が記録されないよう注意

### 2.3 メリット
- PCI DSS 準拠を Stripe が管理
- セキュリティリスクの最小化
- 個人開発レベルでの実装負荷の軽減

## 3. Webアプリ側の基本セキュリティ

### 3.1 HTTPS の利用
- Vercel / Firebase Hosting の HTTPS を利用（デフォルトで有効）
- すべての通信を暗号化

### 3.2 依存ライブラリの管理
- 定期的に `npm update` を実行して依存ライブラリを更新
- 脆弱性情報を確認し、必要に応じて更新

### 3.3 環境変数の管理
- Stripe秘密鍵（`STRIPE_SECRET_KEY`）は環境変数で管理
- Firebase キー（`FIREBASE_SERVICE_ACCOUNT_BASE64`）は環境変数で管理
- `.env.local`（開発環境）と Vercel 環境変数（本番環境）で管理
- 環境変数は Git リポジトリにコミットしない

### 3.4 Firebase Security Rules
- 認証済みユーザーしかアクセスできないよう制御
- ユーザーは自分のデータのみアクセス可能
- データサイズ制限を設定
- 必須フィールドのバリデーションを実施

### 3.5 管理用アカウントのセキュリティ
- Stripe、Firebase、GitHub などの管理用アカウントは必ず2段階認証を有効化
- 強力なパスワードを使用
- 定期的にパスワードを変更

## 4. 不正利用対策

### 4.1 3Dセキュア（EMV 3-D Secure）
- Stripe Checkout セッションで 3Dセキュアを自動的に有効化
- 日本では多くのケースで 3Dセキュア対応が推奨／実質必須
- `payment_method_options.card.request_three_d_secure: 'automatic'` を設定

### 4.2 Stripe Radar
- Stripe Radar の標準ルールを有効化（Stripe ダッシュボードで設定）
- 不正利用の検知と防止

## 5. 運用・体制

### 5.1 脆弱性管理
- ライブラリ・OS等の脆弱性情報を定期的（月1回程度）に確認
- 必要に応じて依存ライブラリを更新
- セキュリティパッチを適用

### 5.2 インシデント対応
#### 情報漏えい疑いが発生した場合の連絡フロー：
1. **即座の対応**
   - 影響範囲の特定
   - 必要に応じてサービスを一時停止

2. **ユーザーへの通知**
   - 影響を受けたユーザーに速やかに通知
   - パスワード変更等の対応を案内

3. **Stripe 等への報告**
   - 決済情報に関連するインシデントの場合は Stripe に報告
   - 必要に応じて関連サービス（Firebase 等）にも報告

4. **記録**
   - インシデントの内容、対応内容、再発防止策を記録

### 5.3 ログインID/パスワード管理
- 管理用アカウントのログインID/パスワードは適切に管理
- 2段階認証を必ず有効化
- パスワードマネージャーを使用

### 5.4 アクセス管理
- 必要最小限の権限のみを付与
- 定期的にアクセス権限を見直し

## 6. データ保護

### 6.1 個人情報の取り扱い
- 個人情報保護法に準拠
- ユーザーの同意なく第三者に提供しない
- データの暗号化を実施（Firebase の標準機能を利用）

### 6.2 データの保存場所
- データは Firebase（Firestore、Storage）に保存
- Firebase のセキュリティ機能を活用

## 7. 監査・記録

### 7.1 ログの記録
- 重要な操作（認証、決済等）のログを記録
- ログには個人情報やカード情報を含めない

### 7.2 定期的な見直し
- 本ポリシーを定期的（四半期ごと）に見直し
- 必要に応じて更新

## 8. 問い合わせ

セキュリティに関する問い合わせやインシデントの報告は、以下までご連絡ください：
- サポートページ: `/support`

---

**最終更新日**: 2024年12月
**次回見直し予定**: 2025年3月

