# 課金導線の設計

## 概要

GarageLogのプレミアムプランへの課金導線を設計し、ユーザーが自然にアップグレードできるよう最適化します。

## 現在の実装状況

### ✅ 実装済みの導線

1. **PaywallModal（ペイウォールモーダル）**
   - プレミアム機能使用時に自動表示
   - トリガー機能に応じたカスタマイズ表示
   - 月額/年額プランの選択

2. **設定ページの請求管理**
   - `/settings/billing` でプラン管理
   - カスタマーポータルへのリンク
   - プラン比較とアップグレードボタン

3. **機能制限による導線**
   - 車両追加時の制限（2台目以降）
   - PDF出力機能の制限
   - OCRスキャン機能の制限

4. **ホームページのアップグレードバナー**
   - 無料ユーザー向けのアップグレード誘導

### ⚠️ 未実装/改善が必要な導線

1. **LPの料金セクション**
   - ✅ 本番環境では有効化済み
   - 新規ユーザーへの最初の導線として機能中

2. **自然な導線の不足**
   - 機能使用中の自然な誘導
   - 価値実感後のタイミングでの誘導

## ユーザージャーニーと導線設計

### フェーズ1: 認知段階（LP）

**目的**: 新規ユーザーにプレミアムの価値を伝える

**導線**:
1. **LPの料金セクション** (`/` の `Pricing` セクション)
   - 無料プランとプレミアムプランの比較
   - 「おすすめ」バッジで年額プランを強調
   - CTAボタン: 「プレミアムを始める」→ `/signup` → 登録後 `/settings/billing`

2. **機能紹介セクション**
   - プレミアム機能（OCR、PDF出力）を魅力的に紹介
   - 「プレミアムで利用可能」バッジを表示

**実装優先度**: 🔴 高（LPの料金セクションを有効化）

---

### フェーズ2: 体験段階（初回使用）

**目的**: 無料プランの価値を実感させつつ、制限を自然に提示

**導線**:
1. **初回車両登録時**
   - 1台目は無料で登録可能
   - 登録完了時に「もう1台登録する」ボタンと共に「プレミアムで無制限に」を表示

2. **ダッシュボードでの価値実感**
   - データが蓄積され始めたタイミング（記録が10件以上）
   - 「PDF出力で履歴を証明書に」バナーを表示

**実装優先度**: 🟡 中

---

### フェーズ3: 制限遭遇段階（機能使用時）

**目的**: 制限に遭遇した瞬間に価値を提示

**導線**:
1. **2台目の車両追加時**
   - `AddCarModal` で `usePremiumGuard` を使用
   - 制限に達したら自動的に `PaywallModal` を表示
   - 機能説明: 「複数台の車を管理できます」

2. **PDF出力機能使用時**
   - PDF出力ボタンクリック時に `checkFeature('pdf_export')`
   - `PaywallModal` で「メンテナンス履歴を証明書として出力」を強調

3. **OCRスキャン機能使用時**
   - OCRボタンクリック時に `checkFeature('ocr_scan')`
   - `PaywallModal` で「レシートを自動読み取り」を強調

**実装優先度**: 🟢 低（既に実装済み）

---

### フェーズ4: 継続利用段階（リテンション）

**目的**: 継続利用ユーザーに価値を再提示

**導線**:
1. **ホームページのアップグレードバナー**
   - 無料ユーザー向けに定期的に表示
   - 使用状況に応じたメッセージ:
     - 記録数が多い場合: 「これまでの記録をPDFで証明書に」
     - 車両が1台の場合: 「複数台の車も管理できます」

2. **設定ページの請求管理**
   - `/settings/billing` で常にアクセス可能
   - プラン比較とアップグレードボタン

**実装優先度**: 🟢 低（既に実装済み）

---

## 導線のタイミングとトリガー

### 即座に表示すべき導線

1. **機能制限に遭遇した瞬間**
   - 2台目の車両追加
   - PDF出力ボタンクリック
   - OCRスキャンボタンクリック

### 遅延表示すべき導線

1. **価値実感後（3-7日後）**
   - 記録が10件以上蓄積された時点
   - 「PDF出力で履歴を証明書に」バナー

2. **定期的なリマインド（30日ごと）**
   - 無料ユーザー向けのアップグレードバナー
   - 使用状況に応じたメッセージ

### 表示を避けるべきタイミング

1. **初回ログイン直後**
   - ユーザーがまだ価値を実感していない
   - 過度な誘導は離脱を招く

2. **エラー発生時**
   - ユーザーが困っている時はサポートを優先

---

## 導線のUI/UX設計

### PaywallModal（ペイウォールモーダル）

**バリアント**:
- `default`: 標準的な表示（機能制限時）
- `minimal`: シンプルな表示（軽い誘導）
- `hero`: 大きく目立つ表示（LPや設定ページ）

**表示内容**:
- トリガーとなった機能の説明
- プレミアム機能の一覧
- 月額/年額プランの選択
- 価格とお得情報

### インライン誘導バナー

**表示場所**:
- ホームページの上部
- ダッシュボードのサイドバー
- 車両一覧ページ

**デザイン**:
- 控えめなデザイン（過度に目立ちすぎない）
- 閉じるボタンを提供
- クリックで `PaywallModal` を開く

---

## メッセージング戦略

### 価値提案のメッセージ

1. **複数車両管理**
   - 「家族の車も一緒に管理」
   - 「複数台の車を一元管理」

2. **PDF出力**
   - 「メンテナンス履歴を証明書として出力」
   - 「売却時に履歴を証明」

3. **OCRスキャン**
   - 「レシートを撮るだけで自動入力」
   - 「手入力の手間を大幅削減」

### お得感の演出

1. **年額プランの強調**
   - 「16%お得」（月額480円×12 = 5,760円 vs 年額4,800円）
   - 「実質2ヶ月分無料」

2. **無料トライアル（将来実装）**
   - 「7日間無料トライアル」
   - 「いつでもキャンセル可能」

---

## 実装タスク

### 優先度: 高 🔴

- [x] **LPの料金セクションを有効化** ✅ 完了
  - `src/app/page.tsx` の `Pricing` セクション
  - 本番環境で有効化済み

### 優先度: 中 🟡

- [ ] **初回車両登録後の誘導**
  - 車両登録完了時に「もう1台登録する」ボタンと共に誘導
  - `AddCarModal` の成功時に表示

- [ ] **価値実感後のバナー表示**
  - 記録が10件以上で「PDF出力で履歴を証明書に」バナー
  - ホームページに条件付きで表示

### 優先度: 低 🟢

- [ ] **定期的なリマインド機能**
  - 30日ごとのアップグレードバナー表示
  - ローカルストレージで表示履歴を管理

- [ ] **A/Bテスト機能**
  - メッセージのバリエーション
  - ボタンの配置や色のテスト

---

## 分析と最適化

### 追跡すべき指標

1. **導線の効果**
   - 各導線からのコンバージョン率
   - PaywallModal の表示回数とクリック率
   - 各機能制限からのコンバージョン率

2. **ユーザー行動**
   - 無料ユーザーの滞在期間
   - プレミアム機能の使用頻度
   - アップグレードまでの日数

### 最適化のポイント

1. **コンバージョン率の高い導線を強化**
2. **表示頻度の調整**（過度な表示は避ける）
3. **メッセージの改善**（A/Bテストで最適化）

---

## 参考資料

- [Stripe Checkout Session API](https://stripe.com/docs/api/checkout/sessions)
- [PaywallModal コンポーネント](../src/components/modals/PaywallModal.tsx)
- [プレミアム機能定義](../src/lib/premium.ts)
- [請求管理ページ](../src/app/settings/billing/page.tsx)

