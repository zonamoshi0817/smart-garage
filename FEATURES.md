# GarageLog 機能一覧

最終更新: 2025年12月20日

## 概要

GarageLog（ガレージログ）は、車両のメンテナンス管理と整備計画機能を提供するWebアプリケーションです。複数の車両を一元管理し、給油記録、メンテナンス履歴、カスタマイズ記録をデジタル化して「見える化」します。

## 主要機能

### 1. 車両管理

#### 基本機能
- **複数車両登録**
  - 無料プラン: 1台まで
  - プレミアムプラン: 無制限
- **車両情報管理**
  - 車名、メーカー、モデル、年式
  - 走行距離（ODO）
  - 車検期限
  - エンジンコード
  - オイル仕様（粘度、API規格、容量）
  - 車両画像（Firebase Storage）
- **車両ステータス管理**
  - 現在保有中（active）
  - 売却済み（sold）
  - 廃車済み（scrapped）
  - その他（other）
- **売却情報記録**
  - 売却日、売却価格、売却先、メモ

#### 高度な機能
- **TypeaheadCarSelector**: 国内外100車種以上の車両データベースから自動補完
- **画像管理**: クライアントサイド圧縮（最長辺1600px、品質85%、最大800KB）
- **デフォルト画像選択**: 6種類のデフォルト画像から選択可能

### 2. 給油記録（Fuel Logs）

#### 基本機能
- **給油記録の登録・編集・削除**
  - 走行距離（ODOメーター or トリップメーター）
  - 給油量（リットル、小数点第1位まで）
  - 金額（円）
  - L価格（単価、円/L）
  - 燃料種別（レギュラー・ハイオク・軽油・EV充電）
  - スタンド名
  - 満タンフラグ
  - 給油日時
  - メモ

#### 統計・分析機能
- **サマリカード表示**
  - 総給油回数
  - 累計給油量（L）
  - 累計ガソリン代（円）
  - 平均単価（円/L）
- **フィルター機能**
  - 検索（日付、給油量、金額、走行距離）
  - 年フィルター
  - 月フィルター
  - 給油タイプフィルター（すべて / 満タンのみ / 部分給油のみ）
  - ソート機能（実施日 / 給油量 / 金額 / 走行距離、昇順/降順）
- **燃費計算**
  - 満タン給油時の燃費自動計算
  - 燃費グラフ表示（時系列）

#### OCR機能（プレミアム）🔒
- **レシート自動読み取り**
  - カメラ撮影 or ファイル選択
  - 給油量（L、リットル、ℓ）の自動抽出
  - 金額（円、¥、合計）の自動抽出
  - L価格（単価）の自動抽出
  - 自動計算: 金額と給油量からL価格を算出
- **初回無料体験**: 1枚のみ無料体験（自動でドラフト保存まで実行）
- **技術**: Tesseract.js（日本語特化）
- **バリデーション**: 給油量は小数点第1位で四捨五入、走行距離整合性チェック

#### 自動機能
- 給油記録追加時に車両の走行距離を自動更新
- 走行距離の整合性チェック（前回給油時との比較）
- トリップメーター選択時の自動計算

### 3. メンテナンス記録・提案

#### 基本機能
- **メンテナンス記録の登録・編集・削除**
  - タイトル（選択式: オイル交換、ブレーキフルード交換など）
  - 説明（自由記述）
  - 費用（円）
  - 走行距離（必須、現在の車両走行距離以上）
  - 日付
  - 場所（自由記述）
- **統計表示**
  - 総メンテナンス回数
  - 累計費用
  - 平均費用
  - 直近メンテナンス日

#### フィルター機能
- 検索（タイトル・説明・場所）
- カテゴリフィルター（エンジン、タイヤ、ブレーキ、排気、ボディ、内装）
- ステータスフィルター
- 並び替え（日付、費用、走行距離、タイトル）

#### 次回メンテナンス提案システム 🆕
- **2軸判定**: 距離（km）と時間（月）の両方で期限を計算
- **早い方を採用**: 距離と時間のうち近い方の期限を提案
- **データ完全性による自動モード切替**
  - High（★★★）: 履歴 + ODO → 最高精度
  - Medium（★★☆）: 履歴のみ → 時間ベース
  - Low（★☆☆）: 履歴なし → 車の登録日から推定

**カンバン風3カラムレイアウト:**
- **緊急** - 期限超過 or 残り≤500km/30日（赤）
- **近日** - スコア≥70%（黄）
- **余裕あり** - それ以外（緑）

**提案アイテム（6種類）:**
- エンジンオイル交換: 5,000km または 6ヶ月
- オイルフィルター交換: 10,000km または 12ヶ月
- タイヤローテーション: 10,000km または 12ヶ月
- ブレーキフルード交換: 24ヶ月
- エアフィルター交換: 30,000km または 24ヶ月
- ワイパーゴム交換: 12ヶ月

#### 自動機能
- メンテナンス記録追加時に車両の走行距離を自動更新
- 走行距離の整合性チェック
- 次回メンテナンス期限の自動計算
- 優先度スコアの自動算出

### 4. カスタマイズ記録

#### 基本機能
- **カスタマイズ記録の登録・編集・削除**
  - タイトル（カスタマイズ名）
  - ブランド、型番
  - カテゴリ（複数選択可）
    - 外装、内装、吸気、排気、ECU、サスペンション
    - ブレーキ、ホイール・タイヤ、エクステリア、インテリア
    - 電装系、駆動系、その他
  - ステータス（計画中、注文済み、取付済み、一時取外し、取外し）
  - 実施日
  - 走行距離（km、オプション）
  - 実施場所（自分で実施、整備工場、ディーラー）
  - 費用内訳（部品代、工賃、その他）
  - 商品リンク（URL）
  - メモ
  - 公開設定

#### 統計表示
- 総カスタマイズ数
- 累計費用（部品代+工賃+その他）
- 平均費用
- 最新カスタマイズ日

#### フィルター機能
- 検索（タイトル、ブランド、メモ）
- カテゴリフィルター
- ステータスフィルター
- 並び替え（実施日、費用、タイトル）

#### カスタムパーツ管理（マイカーページ）
- **12カテゴリのアコーディオン表示**
  1. エンジン（ピストン、カムシャフト、ターボ、インタークーラー）
  2. 排気系（マフラー、エキマニ、触媒）
  3. 吸気系（エアクリーナー、インテークパイプ、スロットル）
  4. サスペンション（ショック、スプリング、アーム、スタビライザー）
  5. ブレーキ（パッド、ローター、キャリパー、ブレーキライン）
  6. ホイール・タイヤ
  7. エクステリア（エアロ、ウィング、ボンネット、ライト）
  8. インテリア（シート、ハンドル、シフトノブ、メーター）
  9. 電装系（バッテリー、オルタネーター、イグニッション）
  10. ECU（ECU、サブコン、ハーネス）
  11. 駆動系（クラッチ、LSD、デフ、ドライブシャフト）
  12. その他

### 5. 保険管理

#### 基本機能
- **保険契約情報の登録・編集・削除**
  - 基本情報: 保険会社、証券番号、商品名
  - 契約期間: 開始日、満期日、契約日
  - 契約者情報: 氏名、住所、記名被保険者
  - 車両情報: ナンバー、車台番号、所有者、用途車種
  - 保険料: 年間合計、初回、2回目以降、分割回数
  - 等級・割引: ノンフリート等級、事故係数、適用割引
  - 補償内容: 対人・対物・人身傷害・車両保険・特約
  - 運転者条件: 運転者限定、年齢条件、家族限定
  - 使用条件: 使用目的、年間走行距離、距離区分

#### OCR機能（プレミアム）🔒
- **保険証券自動読み取り**
  - 対応形式: 画像（JPG, PNG等）
  - 読み取り項目:
    - 保険会社名（12社対応）
    - 証券番号
    - 契約期間（開始日・満期日）
    - 保険料（年額・分割払い対応）
    - 商品名、契約者氏名
    - ナンバー、車台番号
    - ノンフリート等級
    - 割引情報（8種類自動検出）
- **画像前処理**
  - 3倍アップスケール（小さい文字対策）
  - シャープネスフィルタ（文字鮮明化）
  - 適応的ヒストグラム平坦化

### 6. ダッシュボード

#### 基本機能
- **全車横断のメイン画面**
  - 車両情報カード
  - 最近のメンテナンス（最新3件）
  - 給油情報（最新給油と統計）
  - 最近のカスタマイズ（最新3件）

#### 初回ユーザー体験の最適化
- データなし → その場でモーダルを開いて記録追加
- データあり → 専門ページで詳細確認
- オンボーディング（はじめてガイド）
  - ステップ: 「車登録」「給油記録」「メンテ記録」の3項目
  - 完了条件: 各データ1件以上の存在

#### 軽量アラート
- 車検期限が過期: 赤バナーで表示
- 60日以内: 黄バナーで表示

### 7. マイカーページ（車両詳細）

#### 基本構成
- **車両ヘッダー**
  - 車名、年式、型式、現在ODO、直近メンテ日
  - 車両画像
  - 車検期限バッジ・保険期限バッジ

#### クイックアクション（横スクロール）
- ⛽ 給油を記録
- 🔧 メンテを追加
- ✨ カスタム追加
- 📸 レシートOCR 🔒 プレミアム
- 🛡️ 保険を追加
- 📝 車両情報編集
- 📤 PDF/共有 🔒 プレミアム

#### 2カラムレイアウト
**左カラム（メインコンテンツ）:**
- 次回メンテナンス提案
- カスタムパーツパネル

**右カラム（サイドバー）:**
- クイック操作
- 車両サマリー（4つのコンパクトカード）
  - 🛣️ 総走行距離
  - ⛽ 最新給油
  - 🗓️ 次回車検
  - 🔧 直近メンテ
- 状況サマリー

#### 燃費・単価チャート（タブ切替）
- **タブ1: 燃費(km/L)の時系列**
  - 満タン給油時のみプロット
  - 目標ライン（自己ベストの80%）を補助線表示
- **タブ2: ガソリン単価(円/L)の時系列**
  - 全給油記録をプロット
  - 平均単価を補助線表示

### 8. データ管理・エクスポート

#### 基本エクスポート
- 車両データ（CSV）
- メンテナンス履歴（CSV）
- カスタマイズ履歴（CSV）
- 全データ（JSON）

#### 履歴証明書・共有（プレミアム）🔒
- **全車両履歴書（PDF）**: Cloud Functionsで署名トークン生成（7日有効）
- **車両別履歴書（PDF）**: Cloud Functionsで署名トークン生成（7日有効）
- **履歴共有URL生成**: Cloud Functionsで署名トークン生成（30日有効）
- **PDF署名埋め込み**: エクスポート元の正当性証明
- **共有URL閲覧ページ**: 署名トークン検証、読み取り専用UI、統計情報表示

#### データ統計表示
- 登録車両数
- メンテナンス記録数
- 総データサイズ

### 9. 認証・ユーザー管理

#### 基本機能
- Firebase Authenticationによる認証
- Googleアカウントでログイン
- Appleアカウントでログイン（開発中）
- ユーザー情報表示（名前、プラン）
- ユーザー名の最初の文字をアイコンとして表示

### 10. プレミアム機能

#### 無料プランの制限
- **車両登録**: 1台まで（2台目以降はプレミアム必須）
- **OCRスキャン**: 利用不可 🔒
- **PDFエクスポート**: 利用不可 🔒
- **履歴共有URL**: 利用不可 🔒
- **リマインダー**: 車両あたり5件まで
- **スヌーズ**: 3回まで
- **広告**: 表示あり

#### プレミアム機能（主要4機能）
1. **複数車両登録**: 無制限の車両を登録・管理
2. **OCRスキャン**: レシート・保険証券を自動読み取り 🔒
3. **PDFエクスポート**: 全車両の履歴書生成 🔒
4. **履歴共有URL**: 署名付き安全な共有リンク 🔒

#### プレミアム機能（追加）
- **高度なリマインダー**: 無制限、走行距離ベースの推定表示
- **スヌーズ無制限**: リマインダーのスヌーズ回数制限なし
- **領収書自動保存**: OCRスキャン結果の自動保存
- **自動次回予定登録**: メンテナンス完了時に次回を自動設定
- **複数候補レコメンド**: オイル交換時に複数の商品候補
- **フィルター同時表示**: 複数フィルタの組み合わせ
- **詳細データ分析**: 高度な統計レポート
- **優先サポート**: 優先的なカスタマーサポート
- **広告非表示**: アプリ内広告の非表示

#### 料金
- **月額プラン**: 350円/月（7日間無料トライアル）
- **年額プラン**: 3,500円/年（7日間無料トライアル、月額約292円相当）
- **決済**: Stripe Checkout（サブスクリプション管理）

## 技術仕様

### 技術スタック
- **フロントエンド**: Next.js 15.5.7, React 19.2.1, TypeScript
- **バックエンド**: Firebase 12.3.0 (Firestore, Authentication, Storage)
- **決済**: Stripe 19.2.0（サブスクリプション管理）
- **スタイリング**: Tailwind CSS 4
- **バリデーション**: Zod 4.1.11
- **OCR**: Tesseract.js（日本語・英語対応）
- **グラフ**: Recharts 3.2.1
- **PDF生成**: jsPDF 3.0.3, jsPDF-AutoTable 5.0.2
- **エラー監視**: Sentry 10.22.0
- **デプロイ**: Vercel

### データモデル

#### 共通フィールド（BaseEntity）
- `id`: ドキュメントID
- `userId`: ユーザーID（必須、Firestoreセキュリティルールで必須）
- `ownerUid`: 所有者UID（マルチテナンシー対応）
- `createdBy`: 作成者UID（監査ログ用）
- `updatedBy`: 更新者UID（監査ログ用）
- `deletedAt`: 論理削除（null=未削除）
- `createdAt`: 作成日時（Timestamp）
- `updatedAt`: 更新日時（Timestamp）

#### 車両（Car）
- `name`: 車名
- `modelCode`: 型式
- `year`: 年式
- `odoKm`: 走行距離
- `imagePath`: 画像パス
- `inspectionExpiry`: 車検期限（Timestamp）
- `status`: ステータス（active/sold/scrapped/other）
- `soldDate`, `soldPrice`, `soldTo`, `soldNotes`: 売却情報

#### 給油記録（FuelLog）
- `carId`: 車両ID
- `odoKm`: 走行距離
- `quantity`: 量（ml or Wh）
- `unit`: 単位（ml/wh）
- `totalCostJpy`: 総額（円）
- `pricePerUnit`: 単価（円/L or 円/kWh）
- `isFullTank`: 満タンフラグ
- `fuelType`: 燃料種別（regular/premium/diesel/ev）
- `stationName`: スタンド名
- `date`: 給油日時（Timestamp）

#### メンテナンス記録（MaintenanceRecord）
- `carId`: 車両ID
- `title`: タイトル
- `description`: 説明
- `cost`: 費用
- `mileage`: 走行距離（必須）
- `date`: 日付（Timestamp）
- `location`: 場所

#### カスタマイズ記録（Customization）
- `carId`: 車両ID
- `title`: タイトル
- `brand`: ブランド
- `modelCode`: 型番
- `categories`: カテゴリ（配列）
- `status`: ステータス
- `date`: 実施日（Timestamp）
- `partsCostJpy`: 部品代
- `laborCostJpy`: 工賃
- `otherCostJpy`: その他費用

## セキュリティ

### 認証・アクセス制御
- Firebase Authenticationによる認証
- Firebase Storageの権限管理（ユーザー別アクセス制御）
- ユーザー別データ分離（マルチテナンシー）
- 論理削除（deletedAt）による安全なデータ削除
- 監査ログ（Audit Log）による操作履歴の追跡

### データ保護
- **署名トークン**: Cloud Functionsでのみ生成（JWT、HS256）
- **PDFエクスポート**: 7日間有効のトークン
- **共有URL**: 30日間有効のトークン
- **失効機能**: revokedAtによる即座の無効化
- **PDF署名埋め込み**: エクスポート元の正当性証明
- 入力値の検証（Zod）
- エラーハンドリング

## パフォーマンス

### Firestoreクエリ最適化
- **ページング実装**: カーソルベースのページネーション
  - cars: 50件/ページ
  - maintenance: 100件/ページ
- **複合インデックス設計**: carId + date + deletedAt
- **論理削除フィルタリング**: クエリレベルでdeletedAt除外

### クライアントサイド最適化
- リアルタイムデータ同期（onSnapshot）
- 画像圧縮: 最長辺1600px、品質85%、最大800KB
- OCR Web Worker化: メインスレッドをブロックしない
- IndexedDBキャッシュ: traineddataのローカルキャッシュ

## UI/UX

### デザイン原則
- モダンでクリーンなデザイン
- レスポンシブ対応
- 直感的なナビゲーション
- 一貫性のあるカラーテーマ（青系）

### レイアウト
- サイドバーナビゲーション
- メインコンテンツエリア
- モーダルダイアログ
- カード形式の情報表示

### インタラクション
- フィルター機能（車両別、検索）
- 一括操作（削除など）
- リアルタイム更新
- エラーハンドリング
- プラン制限の表示（車両数制限、機能制限）
- アップグレード促進UI

## 法務・サポート

### 法務ページ
- プライバシーポリシー（11章構成）
- 利用規約（12章構成）
- 特定商取引法表記

### サポート動線
- フィードバック送信フォーム
- よくある質問（FAQ）
- 既知の不具合セクション
- お問い合わせ方法（メール・電話）

## 開発・運用

### バージョン管理
- Gitによるバージョン管理
- 開発環境でのテストデータ対応

### モニタリング
- エラー監視: Sentry（クライアント/サーバー/Edge）
- ログ基盤: Cloud Logging構造化ログ
- アナリティクス: Google Analytics（匿名化）
- パフォーマンス: Vercel Analytics
- 決済監視: Stripe Dashboard

### デプロイ
- **プラットフォーム**: Vercel
- **本番URL**: https://garagelog.jp
- **自動デプロイ**: GitHubにプッシュすると自動的にVercelがビルド＆デプロイ

---

## 更新履歴

- 2025年12月20日: 初版作成
